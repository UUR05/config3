# Ассемблер и интерпретатор для УВМ (Учебная Виртуальная Машина)

## Описание проекта

Проект включает в себя полную реализацию ассемблера и интерпретатора для учебной виртуальной машины (УВМ) согласно спецификации.

## Этапы разработки

### Этап 1: Перевод программы в промежуточное представление (etap1.py)
- Парсинг текстового представления команд
- Трансляция в промежуточное представление
- Режим тестирования

### Этап 2: Формирование машинного кода (etap2.py)
- Преобразование команд в двоичное представление
- Запись в бинарный файл
- Вывод статистики ассемблирования

### Этап 3: Интерпретатор и операции с памятью (etap3.py)
- Основной цикл интерпретатора
- Модель объединенной памяти
- Выполнение команд: LOAD_CONST, READ_MEM, WRITE_MEM, BITREVERSE
- Дамп памяти в формате CSV

### Этап 4: Реализация АЛУ (BITREVERSE)
- Команда BITREVERSE полностью реализована
- Проверка математических свойств
- Все тесты проходят успешно

### Этап 5: Для выполнения тестов
- Создать три примера программ с вычислениями над различными данными.
Продемонстрировать, что дамп памяти соответствует требованиям задачи.

## Язык ассемблера УВМ

### Мнемоники команд

#### 1. LOAD_CONST - Загрузка константы
```
LOAD_CONST <значение>
```
- **Описание**: Загружает константу на стек
- **Опкод**: 7
- **Размер**: 5 байт
- **Операнд**: константа (31 бит, биты 6-36)
- **Пример**: `LOAD_CONST 629`
- **Тестовые байты**: `0x47, 0x9D, 0x00, 0x00, 0x00`

#### 2. READ_MEM - Чтение значения из памяти
```
READ_MEM <смещение>
```
- **Описание**: Читает значение из памяти по адресу (адрес с стека + смещение)
- **Опкод**: 61
- **Размер**: 2 байта
- **Операнд**: смещение (10 бит, биты 6-15)
- **Пример**: `READ_MEM 86`
- **Тестовые байты**: `0xBD, 0x15`
- **Работа**: снимает адрес со стека, прибавляет смещение, читает из памяти, кладет результат на стек

#### 3. WRITE_MEM - Запись значения в память
```
WRITE_MEM
```
- **Описание**: Записывает значение в память
- **Опкод**: 27
- **Размер**: 1 байт
- **Операнды**: нет
- **Пример**: `WRITE_MEM`
- **Тестовые байты**: `0x1B`
- **Работа**: снимает адрес со стека, снимает значение со стека, записывает значение по адресу

#### 4. BITREVERSE - Унарная операция разворота битов
```
BITREVERSE <смещение>
```
- **Описание**: Разворачивает биты числа и записывает результат в память
- **Опкод**: 25
- **Размер**: 2 байта
- **Операнд**: смещение (10 бит, биты 6-15)
- **Пример**: `BITREVERSE 224`
- **Тестовые байты**: `0x19, 0x38`
- **Работа**: снимает адрес_базовый со стека, снимает значение со стека, разворачивает биты, записывает в memory[адрес_базовый + смещение]

### Синтаксис

- Одна команда на строку
- Комментарии начинаются с `;`
- Пробельные символы игнорируются
- Аргументы разделяются пробелами или запятыми
- Числа могут быть в десятичном (123) или шестнадцатеричном (0x7B) формате

### Пример программы

```assembly
; Загрузка константы и запись в память
LOAD_CONST 42
LOAD_CONST 100
WRITE_MEM

; Чтение из памяти
LOAD_CONST 100
READ_MEM 0
```

## Использование

### Этап 1: Ассемблирование (промежуточное представление)

```bash
python etap1.py input.asm -o output.ir --test
```

Параметры:
- `input.asm` - исходный файл с программой на языке ассемблера
- `-o output.ir` - файл для сохранения промежуточного представления
- `--test` - режим тестирования (вывод IR в hex-формате)

### Этап 2: Ассемблирование (машинный код)

```bash
python etap2.py input.asm -o program.bin --test
```

Параметры:
- `input.asm` - исходный файл с программой
- `-o program.bin` - бинарный файл результата
- `--test` - вывод машинного кода в байтовом формате

### Этап 3: Интерпретация

```bash
python etap3.py program.bin -o memory_dump.csv -r 0-300 -m 1024
```

Параметры:
- `program.bin` - бинарный файл с программой
- `-o memory_dump.csv` - файл для сохранения дампа памяти (CSV)
- `-r 0-300` - диапазон адресов для дампа памяти (от-до)
- `-m 1024` - размер памяти в словах (по умолчанию 1024)

### Тестирование базовых команд

```bash
# Ассемблировать с тестовым выводом
python etap2.py test.asm --test

# Исполнить
python etap3.py program.bin -o test_memory.csv -r 0-100
```

## Формат CSV для дампа памяти

```csv
Address,Value
0,10
1,20
2,30
...
```

## Структура проекта

```
config/
├── etap1.py           # Этап 1: промежуточное представление
├── etap2.py           # Этап 2: генерация машинного кода
├── etap3.py           # Этап 3: интерпретатор
├── etap4.py           # Этап 4: реализация АЛУ
├── etap3.py           # Этап 5: для итоговых тестов
├── test.asm           # Тестовая программа (все команды)
├── copy_array.asm     # Программа копирования массива
├── README.md          # Документация
└── program.bin        # Скомпилированная программа (генерируется)
```

## Технические детали реализации

### Формат команд

Все команды кодируются в little-endian формате:
- Биты 0-5: опкод (A)
- Биты 6-...: операнды (B)

### Стек

Стек работает по принципу LIFO (Last In, First Out). Команды могут:
- Помещать значения на стек (LOAD_CONST, READ_MEM)
- Снимать значения со стека (WRITE_MEM, BITREVERSE)

### Цикл интерпретации

1. Загрузка программы в память
2. Инициализация программного счетчика (PC = 0)
3. Цикл:
   - Декодирование команды по адресу PC
   - Выполнение команды
   - Обновление PC
4. Сохранение дампа памяти

## Требования

- Python 3.6+
- Стандартная библиотека Python (argparse, sys, csv, re)

### Тест
python etap1.py test.asm --test

<img width="478" height="101" alt="image" src="https://github.com/user-attachments/assets/56b5bfb5-ac07-4ccb-9932-65cc926c5da6" />

python etap2.py test.asm --test

<img width="484" height="124" alt="image" src="https://github.com/user-attachments/assets/a0c75641-f421-4242-9712-c1139345c718" />

python etap3.py copy_array.bin -o ppp.csv -r 95-205

<img width="587" height="614" alt="image" src="https://github.com/user-attachments/assets/4ec5b661-97cb-4062-befb-3796f29d2ed6" />

python etap4.py ppp.bin -o sss.csv -r 95-205

<img width="566" height="458" alt="image" src="https://github.com/user-attachments/assets/44dd924b-1e18-478b-88d2-7737a9c2d4e4" />

python etap5.py etap5_example1.bin -o etap5_example1.csv -r 95-205

<img width="604" height="499" alt="image" src="https://github.com/user-attachments/assets/d022c4e3-922a-4ad2-a2ed-dfcdb3a7e1dd" />

